<?php
/*
 Hash file generator for WordPress Exploit Scanner
 Author: mattyrob
 Author URI: http://subscribe2.wordpress.com/
*/
$file = 'latest.zip';
if ( !is_readable($file) ) {
	echo "No WordPress archive available. Ensure the file is called 'latest.zip'.";
	exit;
}
$hashes = "&lt;" . '?php' . "\r\n" . '$filehashes = array(' . "\r\n";
$zip = zip_open(getcwd(). '/' . $file);
if ( is_resource($zip) ) {
	while ( $zip_entry = zip_read($zip) ) {
		zip_entry_open($zip, $zip_entry, "r");
		$file = zip_entry_read($zip_entry, zip_entry_filesize($zip_entry));
		if ( substr(zip_entry_name($zip_entry), -1, 1) !== "/" && strstr(zip_entry_name($zip_entry), 'wp-content/plugins/') === false && strstr(zip_entry_name($zip_entry), 'wp-content/themes/') === false ) {
			list($wp, $filename) = explode('/', zip_entry_name($zip_entry), 2);
			$hashes .= "'" .  $filename . "' => '" . md5($file) . "',\r\n";
		}
		zip_entry_close($zip_entry);
	}
	zip_close($zip);
}
$hashes .= ");\r\n?>";

if ( 'cli' == php_sapi_name() ) {
	print $hashes;
} else {
	echo "<pre>";
	echo $hashes;
	echo "</pre>";
}